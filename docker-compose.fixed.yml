version: '3.8'

services:
  # Memory System Core Service
  memory-system:
    image: node:18-alpine
    container_name: memory-system
    restart: unless-stopped
    command: ["node", "/opt/memory-system/start.js"]
    working_dir: /opt/memory-system
    ports:
      - "3000:3000"   # HTTP API for all clients
    environment:
      - NODE_ENV=production
      - SERVER_HOST=0.0.0.0
      - SERVER_PORT=3000
      - MCP_PORT=8080
      - DATA_DIR=/app/data
      - MAX_RESULTS=10
      - MIN_SIMILARITY=0.1
      - EMBEDDING_DIMENSION=768
      - CACHE_SIZE=1000
    volumes:
      # Mount data directly to host filesystem for backup
      - /opt/memory-system/data:/app/data
      - /opt/memory-system/logs:/app/logs
      - /opt/memory-system/backups:/app/backups
    networks:
      - memory-network
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:3000/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s

networks:
  memory-network:
    driver: bridge